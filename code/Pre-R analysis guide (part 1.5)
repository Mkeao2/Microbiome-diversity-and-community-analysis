**Statistical Analysis in RStudio**

__Import data__
  Metadata (.tsv or .txt)
  Table (.qza)
  Tree (.qza)
  Taxonomy (.txt or .qza)

__Create phyloseq object__
  Using qza_to_phyloseq or merge_phyloseq to combine your .qza and .txt files

__Identify and remove contaminants, blanks, etc.__
  Run the isContaminant function to check for contaminants
  Check for tag jumping of other contaminants and proportionally remove relative to the counts present in the blanks
  Prune_samples to remove any blanks, unwanted taxa, etc.

__Compute prevalence and abundance and remove any taxa not meeting minimum counts__

__Assign taxa names to OTU IDS.__ 

#Note that you have to download everything needed for taxizedb before these steps, which can take awhile! 

#Table1 is a wide dataset with OTU, genus or family name ('tax'), and all samples with occurence data. 
#This gives you taxa names/numbers for your rows and makes a list of unique IDs. 
taxnames <- name2taxid(Table1$tax, db="ncbi", out_type = "summary")

#Gets all other taxonomic rank info for your names. 
taxa <- classification(taxnames$id, db="ncbi")

#Changes from a classification object to a data frame/ table
taxa_wide <- lapply(taxa, function(x) {
  tidyr::pivot_wider(
    x[,1:2],
    names_from = rank,
    values_from = name,
    values_fn = function(x) paste(x, collapse = "|"))
})

tbl <- dplyr::bind_rows(taxa_wide)
